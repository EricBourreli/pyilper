#!/usr/bin/python3
# -*- coding: utf-8 -*-
# pilcharconv for Linux
#
# (c) 2015 Joachim Siebold
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
#
# character conversion ---------------------------------------
#
# Changelog
#
# 19.02.2016 jsi:
# - added stringconv function
#
CHARSET_HP71=0
CHARSET_HP41=1
CHARSET_ROMAN8=2

charsets= [ "HP-71", "HP-41", "ROMAN-8"]

# dictionary hp-71 character set to unicode
hp71_unicode = {
  0 : ' ', 
  1 : '°', 
# 2 : '\u0304x',
  2 : 'x',
  3 : '\u2190' ,
  4 : '\u03B1' ,
  5 : '\u03B2' ,
  6 : '\u03B3' ,
  7 : '\u2618' , # bell!
  8 : chr(8),
  9 : '\u03A3' ,
  10 : chr(10),
  11 : '\u03BB' ,
  12 : '\u03Bc' ,
  13 : chr(13),
  14 : '\u03C4' ,
  15 : '\u03A6' ,
  16 : '\u03B8' ,
  17 : '\u03A9' ,
  18 : '\u03B4' ,
  19 : '\u03B5' ,
  20 : '\u03C0',
  21 : 'Ä' ,
  22 : 'ä' ,
  23 : 'Ö' ,
  24 : 'ö' ,
  25 : 'Ü' ,
  26 : 'ü',
  27 : chr(27),
  28 : '\u03A3' ,
  29 : '\u2260' ,
  30 : '£',
  31 : '\u25AF' ,
  32 : ' ' ,
  33 : '!' ,
  34 : '"' ,
  35 : '#' ,
  36 : '$' ,
  37 : '%' ,
  38 : '&' ,
  39 : '\'' ,
  40 : '(' ,
  41 : ')' ,
  42 : '*' ,
  43 : '+' ,
  44 : ',' ,
  45 : '-' ,
  46 : '.' ,
  47 : '/' ,
  48 : '0' ,
  49 : '1' ,
  50 : '2' ,
  51 : '3' ,
  52 : '4' ,
  53 : '5' ,
  54 : '6' ,
  55 : '7' ,
  56 : '8' ,
  57 : '9' ,
  58 : ':' ,
  59 : ';' ,
  60 : '<' ,
  61 : '=' ,
  62 : '>' ,
  63 : '?' ,
  64 : '@' ,
  65 : 'A' ,
  66 : 'B' ,
  67 : 'C' ,
  68 : 'D' ,
  69 : 'E' ,
  70 : 'F' ,
  71 : 'G' ,
  72 : 'H' ,
  73 : 'I' ,
  74 : 'J' ,
  75 : 'K' ,
  76 : 'L' ,
  77 : 'M' ,
  78 : 'N' ,
  79 : 'O' ,
  80 : 'P' ,
  81 : 'Q' ,
  82 : 'R' ,
  83 : 'S' ,
  84 : 'T' ,
  85 : 'U' ,
  86 : 'V' ,
  87 : 'W' ,
  88 : 'X' ,
  89 : 'Y' ,
  90 : 'Z' ,
  91 : '[' ,
  92 : '\\' ,
  93 : ']' ,
  94 : '^' ,
  95 : '_' ,
  96 : '\\' ,
  97 : 'a' ,
  98 : 'b' ,
  99 : 'c' ,
  100 : 'd' ,
  101 : 'e' ,
  102 : 'f' ,
  103 : 'g' ,
  104 : 'h' ,
  105 : 'i' ,
  106 : 'j' ,
  107 : 'k' ,
  108 : 'l' ,
  109 : 'm' ,
  110 : 'n' ,
  111 : 'o' ,
  112 : 'p' ,
  113 : 'q' ,
  114 : 'r' ,
  115 : 's' ,
  116 : 't' ,
  117 : 'u' ,
  118 : 'v' ,
  119 : 'w' ,
  120 : 'x' ,
  121 : 'y' ,
  122 : 'z' ,
  123 : '{' ,
  124 : '|' ,
  125 : '}' ,
  126 : '~' ,
  127 : '\u251C' ,
  128 : ' ', 
  129 : '°', 
# 130 : '\u0304x',
  130 : 'x',
  131 : '\u2190' ,
  132 : '\u03B1' ,
  133 : '\u03B2' ,
  134 : '\u03B3' ,
  135 : '\u2618' ,
  136 : '\u25AF' ,
  137 : '\u03A3' ,
  138 : '\u25AF' ,
  139 : '\u03BB' ,
  140 : '\u03Bc' ,
  141 : '\u25AF' ,
  142 : '\u03C4' ,
  143 : '\u03A6' ,
  144 : '\u03B8' ,
  145 : '\u03A9' ,
  146 : '\u03B4' ,
  147 : '\u03B5' ,
  148 : '\u03C0',
  149 : 'Ä' ,
  150 : 'ä' ,
  151 : 'Ö' ,
  152 : 'ö' ,
  153 : 'Ü' ,
  154 : 'ü',
  155 : '\u25AF' ,
  156 : '\u03A3' ,
  157 : '\u2260' ,
  158 : '£',
  159 : '\u25AF' ,
  160 : ' ' ,
  161 : '!' ,
  162 : '"' ,
  163 : '#' ,
  164 : '$' ,
  165 : '%' ,
  166 : '&' ,
  167 : '\\' ,
  168 : '(' ,
  169 : ')' ,
  170 : '*' ,
  171 : '+' ,
  172 : ',' ,
  173 : '-' ,
  174 : '.' ,
  175 : '/' ,
  176 : '0' ,
  177 : '1' ,
  178 : '2' ,
  179 : '3' ,
  180 : '4' ,
  181 : '5' ,
  182 : '6' ,
  183 : '7' ,
  184 : '8' ,
  185 : '9' ,
  186 : ':' ,
  187 : ';' ,
  188 : '<' ,
  189 : '=' ,
  190 : '>' ,
  191 : '?' ,
  192 : '@' ,
  193 : 'A' ,
  194 : 'B' ,
  195 : 'C' ,
  196 : 'D' ,
  197 : 'E' ,
  198 : 'F' ,
  199 : 'G' ,
  200 : 'H' ,
  201 : 'I' ,
  202 : 'J' ,
  203 : 'K' ,
  204 : 'L' ,
  205 : 'M' ,
  206 : 'N' ,
  207 : 'O' ,
  208 : 'P' ,
  209 : 'Q' ,
  210 : 'R' ,
  211 : 'S' ,
  212 : 'T' ,
  213 : 'U' ,
  214 : 'V' ,
  215 : 'W' ,
  216 : 'X' ,
  217 : 'Y' ,
  218 : 'Z' ,
  219 : '[' ,
  220 : '\\' ,
  221 : ']' ,
  222 : '^' ,
  223 : '_' ,
  224 : '\'' ,
  225 : 'a' ,
  226 : 'b' ,
  227 : 'c' ,
  228 : 'd' ,
  229 : 'e' ,
  230 : 'f' ,
  231 : 'g' ,
  232 : 'h' ,
  233 : 'i' ,
  234 : 'j' ,
  235 : 'k' ,
  236 : 'l' ,
  237 : 'm' ,
  238 : 'n' ,
  239 : 'o' ,
  240 : 'p' ,
  241 : 'q' ,
  242 : 'r' ,
  243 : 's' ,
  244 : 't' ,
  245 : 'u' ,
  246 : 'v' ,
  247 : 'w' ,
  248 : 'x' ,
  249 : 'y' ,
  250 : 'z' ,
  251 : '{' ,
  252 : '|' ,
  253 : '}' ,
  254 : '~' ,
  255 : '\u251C' ,
} 

hp41_unicode = {
  0 : '\u25C6', 
  1 : '\u03F0', 
# 2 : '\u0304x',
  2 : 'x',
  3 : '\u2190' ,
  4 : '\u03B1' ,
  5 : '\u03B2' ,
  6 : '\u03B3' ,
  7 : '\u2193' , 
  8 : '\u03B4',
  9 : '\u03A3' ,
  10 : chr(10),
  11 : '\u03BB' ,
  12 : '\u03Bc' ,
  13 : chr(13),
  14 : '\u03C4' ,
  15 : '\u03A6' ,
  16 : '\u03B8' ,
  17 : '\u03A9' ,
  18 : '\u03B4' ,
  19 : '\u00C5' ,
  20 : '\u00E5',
  21 : 'Ä' ,
  22 : 'ä' ,
  23 : 'Ö' ,
  24 : 'ö' ,
  25 : 'Ü' ,
  26 : 'ü',
  27 : '\u00C6',
  28 : '\u00E6' ,
  29 : '\u2260' ,
  30 : '£',
  31 : '\u25AF' ,
  32 : ' ' ,
  33 : '!' ,
  34 : '"' ,
  35 : '#' ,
  36 : '$' ,
  37 : '%' ,
  38 : '&' ,
  39 : '\'' ,
  40 : '(' ,
  41 : ')' ,
  42 : '*' ,
  43 : '+' ,
  44 : ',' ,
  45 : '-' ,
  46 : '.' ,
  47 : '/' ,
  48 : '0' ,
  49 : '1' ,
  50 : '2' ,
  51 : '3' ,
  52 : '4' ,
  53 : '5' ,
  54 : '6' ,
  55 : '7' ,
  56 : '8' ,
  57 : '9' ,
  58 : ':' ,
  59 : ';' ,
  60 : '<' ,
  61 : '=' ,
  62 : '>' ,
  63 : '?' ,
  64 : '@' ,
  65 : 'A' ,
  66 : 'B' ,
  67 : 'C' ,
  68 : 'D' ,
  69 : 'E' ,
  70 : 'F' ,
  71 : 'G' ,
  72 : 'H' ,
  73 : 'I' ,
  74 : 'J' ,
  75 : 'K' ,
  76 : 'L' ,
  77 : 'M' ,
  78 : 'N' ,
  79 : 'O' ,
  80 : 'P' ,
  81 : 'Q' ,
  82 : 'R' ,
  83 : 'S' ,
  84 : 'T' ,
  85 : 'U' ,
  86 : 'V' ,
  87 : 'W' ,
  88 : 'X' ,
  89 : 'Y' ,
  90 : 'Z' ,
  91 : '[' ,
  92 : '\\' ,
  93 : ']' ,
  94 : '\u2191' ,
  95 : '_' ,
  96 : '\\' ,
  97 : 'a' ,
  98 : 'b' ,
  99 : 'c' ,
  100 : 'd' ,
  101 : 'e' ,
  102 : 'f' ,
  103 : 'g' ,
  104 : 'h' ,
  105 : 'i' ,
  106 : 'j' ,
  107 : 'k' ,
  108 : 'l' ,
  109 : 'm' ,
  110 : 'n' ,
  111 : 'o' ,
  112 : 'p' ,
  113 : 'q' ,
  114 : 'r' ,
  115 : 's' ,
  116 : 't' ,
  117 : 'u' ,
  118 : 'v' ,
  119 : 'w' ,
  120 : 'x' ,
  121 : 'y' ,
  122 : 'z' ,
  123 : '\u03C0' ,
  124 : '\u2280' , 
  125 : '\u2190' , 
  126 : '\u03A3' , 
  127 : '\u251C' ,
  128 : '\u25C6', 
  129 : '\u03F0', 
# 130 : '\u0304x',
  130 : 'x',
  131 : '\u2190' ,
  132 : '\u03B1' ,
  133 : '\u03B2' ,
  134 : '\u03B3' ,
  135 : '\u2193' , 
  136 : '\u03B4',
  137 : '\u03A3' ,
  138 : chr(10),
  139 : '\u03BB' ,
  140 : '\u03Bc' ,
  141 : chr(13),
  142 : '\u03C4' ,
  143 : '\u03A6' ,
  144 : '\u03B8' ,
  145 : '\u03A9' ,
  146 : '\u03B4' ,
  147 : '\u00C5' ,
  148 : '\u00E5',
  149 : 'Ä' ,
  150 : 'ä' ,
  151 : 'Ö' ,
  152 : 'ö' ,
  153 : 'Ü' ,
  154 : 'ü',
  155 : '\u00C6',
  156 : '\u00E6' ,
  157 : '\u2260' ,
  158 : '£',
  159 : '\u25AF' ,
  160 : ' ' ,
  161 : '!' ,
  162 : '"' ,
  163 : '#' ,
  164 : '$' ,
  165 : '%' ,
  166 : '&' ,
  167 : '\\' ,
  168 : '(' ,
  169 : ')' ,
  170 : '*' ,
  171 : '+' ,
  172 : ',' ,
  173 : '-' ,
  174 : '.' ,
  175 : '/' ,
  176 : '0' ,
  177 : '1' ,
  178 : '2' ,
  179 : '3' ,
  180 : '4' ,
  181 : '5' ,
  182 : '6' ,
  183 : '7' ,
  184 : '8' ,
  185 : '9' ,
  186 : ':' ,
  187 : ';' ,
  188 : '<' ,
  189 : '=' ,
  190 : '>' ,
  191 : '?' ,
  192 : '@' ,
  193 : 'A' ,
  194 : 'B' ,
  195 : 'C' ,
  196 : 'D' ,
  197 : 'E' ,
  198 : 'F' ,
  199 : 'G' ,
  200 : 'H' ,
  201 : 'I' ,
  202 : 'J' ,
  203 : 'K' ,
  204 : 'L' ,
  205 : 'M' ,
  206 : 'N' ,
  207 : 'O' ,
  208 : 'P' ,
  209 : 'Q' ,
  210 : 'R' ,
  211 : 'S' ,
  212 : 'T' ,
  213 : 'U' ,
  214 : 'V' ,
  215 : 'W' ,
  216 : 'X' ,
  217 : 'Y' ,
  218 : 'Z' ,
  219 : '[' ,
  220 : '\\' ,
  221 : ']' ,
  222 : '^' ,
  223 : '_' ,
  224 : '\'' ,
  225 : 'a' ,
  226 : 'b' ,
  227 : 'c' ,
  228 : 'd' ,
  229 : 'e' ,
  230 : 'f' ,
  231 : 'g' ,
  232 : 'h' ,
  233 : 'i' ,
  234 : 'j' ,
  235 : 'k' ,
  236 : 'l' ,
  237 : 'm' ,
  238 : 'n' ,
  239 : 'o' ,
  240 : 'p' ,
  241 : 'q' ,
  242 : 'r' ,
  243 : 's' ,
  244 : 't' ,
  245 : 'u' ,
  246 : 'v' ,
  247 : 'w' ,
  248 : 'x' ,
  249 : 'y' ,
  250 : 'z' ,
  251 : '{' ,
  252 : '|' ,
  253 : '}' ,
  254 : '~' ,
  255 : '\u251C' 
} 

def charconv(s, charset):
   if charset== CHARSET_HP71:
      return(hp71_unicode[ord(s)])
   elif charset== CHARSET_HP41:
      return(hp41_unicode[ord(s)])
   elif charset == CHARSET_ROMAN8:
      b=bytearray(1)
      b[0]= ord(s)
      s=b.decode("HP-ROMAN8","ignore")
      return(s)

#
# convert a bytearray to a string
#

def stringconv(barr, charset):
   slist= []
   for c in barr:
      if charset== CHARSET_HP71:
         slist.append(hp71_unicode[c])
      elif charset== CHARSET_HP41:
         slist.append(hp41_unicode[c])
      elif charset == CHARSET_ROMAN8:
         b=bytearray(1)
         b[0]= c
         slist.append(b.decode("HP-ROMAN8","ignore"))
   return "".join(slist)

